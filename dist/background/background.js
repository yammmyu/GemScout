chrome.runtime.onInstalled.addListener(()=>{console.log("GemScout extension installed"),chrome.storage.sync.get(["gemscout_settings"],t=>{if(!t.gemscout_settings){const a={autoAnalyze:!0,showOverlay:!0,jobSites:["linkedin.com","indeed.com","glassdoor.com"],matchThreshold:70,notifications:!0};chrome.storage.sync.set({gemscout_settings:a}),console.log("Default settings initialized")}})});chrome.action.onClicked.addListener(t=>{console.log("Extension icon clicked for tab:",t.url)});chrome.runtime.onMessage.addListener((t,a,s)=>{var n;switch(console.log("Message received:",t),t.type){case"PAGE_ANALYZED":console.log("Page analyzed:",t.data),chrome.storage.local.get(["page_analyses"],e=>{var c;const o=e.page_analyses||[];o.unshift({...t.data,timestamp:Date.now(),tabId:(c=a.tab)==null?void 0:c.id}),o.length>50&&o.splice(50),chrome.storage.local.set({page_analyses:o})}),chrome.storage.sync.get(["gemscout_settings"],e=>{const o=e.gemscout_settings;o!=null&&o.notifications&&t.data.jobIndicators&&chrome.notifications.create({type:"basic",iconUrl:"assets/icon-48.png",title:"GemScout",message:"Job opportunities detected on this page!"})}),s({success:!0});break;case"GET_ANALYSES":return chrome.storage.local.get(["page_analyses"],e=>{s({success:!0,analyses:e.page_analyses||[]})}),!0;case"CLEAR_ANALYSES":return chrome.storage.local.remove(["page_analyses"],()=>{s({success:!0})}),!0;case"TOGGLE_OVERLAY":if((n=a.tab)!=null&&n.id)return chrome.tabs.sendMessage(a.tab.id,{type:"TOGGLE_OVERLAY"},e=>{s(e||{success:!1,error:"No response from content script"})}),!0;break;case"ANALYZE_CURRENT_TAB":return chrome.tabs.query({active:!0,currentWindow:!0},e=>{var o;(o=e[0])!=null&&o.id?chrome.tabs.sendMessage(e[0].id,{type:"ANALYZE_PAGE"},c=>{s(c||{success:!1,error:"No response from content script"})}):s({success:!1,error:"No active tab found"})}),!0;default:console.log("Unknown message type:",t.type),s({success:!1,error:"Unknown message type"})}});chrome.tabs.onUpdated.addListener((t,a,s)=>{a.status==="complete"&&s.url&&chrome.storage.sync.get(["gemscout_settings"],n=>{const e=n.gemscout_settings;e!=null&&e.autoAnalyze&&(e.jobSites||["linkedin.com","indeed.com","glassdoor.com"]).some(r=>{var i;return(i=s.url)==null?void 0:i.includes(r)})&&setTimeout(()=>{chrome.tabs.sendMessage(t,{type:"ANALYZE_PAGE"})},2e3)})});chrome.runtime.onStartup.addListener(()=>{chrome.storage.sync.get(["gemscout_settings"],t=>{const a=t.gemscout_settings;a!=null&&a.notifications&&chrome.notifications.getPermissionLevel(s=>{s!=="granted"&&console.log("Notification permission not granted")})})});
